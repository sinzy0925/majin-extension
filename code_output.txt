ã“ã®ã‚¨ãƒ©ãƒ¼ã‚’ãªã‚“ã¨ã‹ã¤ã¶ã—ãŸã„

The specified value "" does not conform to the required format. The format is "#rrggbb" where rr, gg, bb are two-digit hexadecimal numbers.
ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ
popup.html
ã‚¹ã‚¿ãƒƒã‚¯ ãƒˆãƒ¬ãƒ¼ã‚¹
popup.js:94 (ç„¡åé–¢æ•°)


---


- ãƒ•ã‚©ãƒ«ãƒ€å: .
- ãƒ•ã‚¡ã‚¤ãƒ«å: 0.gs
- å†…å®¹:
const str_FOOTER_TEXT = `Â© ${new Date().getFullYear()} Google Inc.`;
const str_LOGOS_header= 'https://upload.wikimedia.org/wikipedia/commons/thumb/2/2f/Google_2015_logo.svg/640px-Google_2015_logo.svg.png';
const str_LOGOS_closing= 'https://upload.wikimedia.org/wikipedia/commons/thumb/2/2f/Google_2015_logo.svg/640px-Google_2015_logo.svg.png';
const str_primary_color= '#4285F4';
const str_bg_gradient_start_color= '#FFFFFF';
const str_bg_gradient_end_color= '#00FFFF';
const str_content_background_image_url= null;
const str_title_background_image_url= null; 
const str_closing_background_image_url= null; 




---


- ãƒ•ã‚©ãƒ«ãƒ€å: .
- ãƒ•ã‚¡ã‚¤ãƒ«å: 1.gs
- å†…å®¹:
// --- 1. å®Ÿè¡Œè¨­å®š ---
const SETTINGS = {
SHOULD_CLEAR_ALL_SLIDES: true,
TARGET_PRESENTATION_ID: null
};

// --- 2. ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ã‚¶ã‚¤ãƒ³è¨­å®š (Pixel Perfect Ver.) ---
const CONFIG = {
BASE_PX: { W: 960, H: 540 },

// ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã®åŸºæº–ã¨ãªã‚‹ä¸å¤‰ã®pxå€¤
POS_PX: {
titleSlide: {
logo:       { left: 55,  top: 105,  width: 135 },
title:      { left: 50,  top: 200, width: 830, height: 90 },
date:       { left: 50,  top: 450, width: 250, height: 40 },
},

// å…±é€šãƒ˜ãƒƒãƒ€ãƒ¼ã‚’æŒã¤å„ã‚¹ãƒ©ã‚¤ãƒ‰  
contentSlide: {  
  headerLogo:     { right: 20, top: 20, width: 75 },  
  title:          { left: 25, top: 50,  width: 830, height: 65 },  
  titleUnderline: { left: 25, top: 118, width: 260, height: 4 },  
  subhead:        { left: 25, top: 130, width: 830, height: 40 },  
  body:           { left: 25, top: 172, width: 910, height: 290 },  
  twoColLeft:     { left: 25,  top: 172, width: 440, height: 290 },  
  twoColRight:    { left: 495, top: 172, width: 440, height: 290 }  
},  
compareSlide: {  
  headerLogo:     { right: 20, top: 20, width: 75 },  
  title:          { left: 25, top: 50,  width: 830, height: 65 },  
  titleUnderline: { left: 25, top: 118, width: 260, height: 4 },  
  subhead:        { left: 25, top: 130, width: 830, height: 40 },  
  leftBox:        { left: 25,  top: 152, width: 430, height: 290 },  
  rightBox:       { left: 485, top: 152, width: 430, height: 290 }  
},  
processSlide: {  
  headerLogo:     { right: 20, top: 20, width: 75 },  
  title:          { left: 25, top: 50,  width: 830, height: 65 },  
  titleUnderline: { left: 25, top: 118, width: 260, height: 4 },  
  subhead:        { left: 25, top: 130, width: 830, height: 40 },  
  area:           { left: 25, top: 152, width: 910, height: 290 }  
},  
timelineSlide: {  
  headerLogo:     { right: 20, top: 20, width: 75 },  
  title:          { left: 25, top: 50,  width: 830, height: 65 },  
  titleUnderline: { left: 25, top: 118, width: 260, height: 4 },  
  subhead:        { left: 25, top: 130, width: 830, height: 40 },  
  area:           { left: 25, top: 172, width: 910, height: 290 }  
},  
diagramSlide: {  
  headerLogo:     { right: 20, top: 20, width: 75 },  
  title:          { left: 25, top: 50,  width: 830, height: 65 },  
  titleUnderline: { left: 25, top: 118, width: 260, height: 4 },  
  subhead:        { left: 25, top: 130, width: 830, height: 40 },  
  lanesArea:      { left: 25, top: 172, width: 910, height: 290 }  
},  
cardsSlide: { // This POS_PX is used by both cards and headerCards
  headerLogo:     { right: 20, top: 20, width: 75 },  
  title:          { left: 25, top: 50,  width: 830, height: 65 },  
  titleUnderline: { left: 25, top: 118, width: 260, height: 4 },  
  subhead:        { left: 25, top: 130, width: 830, height: 40 },  
  gridArea:       { left: 25, top: 160, width: 910, height: 290 }  
},  
tableSlide: {  
  headerLogo:     { right: 20, top: 20, width: 75 },  
  title:          { left: 25, top: 50,  width: 830, height: 65 },  
  titleUnderline: { left: 25, top: 118, width: 260, height: 4 },  
  subhead:        { left: 25, top: 130, width: 830, height: 40 },  
  area:           { left: 25, top: 160, width: 910, height: 290 }  
},  
progressSlide: {  
  headerLogo:     { right: 20, top: 20, width: 75 },  
  title:          { left: 25, top: 50,  width: 830, height: 65 },  
  titleUnderline: { left: 25, top: 118, width: 260, height: 4 },  
  subhead:        { left: 25, top: 130, width: 830, height: 40 },  
  area:           { left: 25, top: 172, width: 910, height: 290 }  
},

quoteSlide: {
  headerLogo:     { right: 20, top: 20, width: 75 },
  title:          { left: 25, top: 50,  width: 830, height: 65 },
  titleUnderline: { left: 25, top: 118, width: 260, height: 4 },
  subhead:        { left: 25, top: 130, width: 830, height: 40 },
  quoteMark:      { left: 40, top: 180, width: 100, height: 100 },
  quoteText:      { left: 150, top: 210, width: 700, height: 150 },
  author:         { right: 110, top: 370, width: 700, height: 30 }
},

kpiSlide: {
  headerLogo:     { right: 20, top: 20, width: 75 },
  title:          { left: 25, top: 50,  width: 830, height: 65 },
  titleUnderline: { left: 25, top: 118, width: 260, height: 4 },
  subhead:        { left: 25, top: 130, width: 830, height: 40 },
  gridArea:       { left: 25, top: 172, width: 910, height: 290 }
},

statsCompareSlide: {
  headerLogo:     { right: 20, top: 20, width: 75 },
  title:          { left: 25, top: 50,  width: 830, height: 65 },
  titleUnderline: { left: 25, top: 118, width: 260, height: 4 },
  subhead:        { left: 25, top: 130, width: 830, height: 40 },
  leftArea:       { left: 25, top: 172, width: 430, height: 290 },
  rightArea:      { left: 485, top: 172, width: 430, height: 290 }
},

sectionSlide: {  
  title:      { left: 55, top: 230, width: 840, height: 80 },  
  ghostNum:   { left: 35, top: 120, width: 400, height: 200 }
},

footer: {  
  leftText:  { left: 15, top: 505, width: 250, height: 20 },  
  rightPage: { right: 15, top: 505, width: 50,  height: 20 }  
},  
bottomBar: { left: 0, top: 534, width: 960, height: 6 }  

},

FONTS: {
family: 'Arial', // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã€ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‹ã‚‰å‹•çš„ã«å¤‰æ›´å¯èƒ½
sizes: {
title: 32, 
sectionTitle: 30, 
contentTitle: 24, 
subhead: 20,
body: 16, 
laneTitle: 14, 
processStep: 17, 
date: 16, 
footer: 9, 
chip: 11, 
small: 10,
axis: 12, 
ghostNum: 180
}
},
COLORS: {
primary_color: str_primary_color, 
text_primary: '#333333', 

background_white: '#FFFFFF',
background_gray: '#f8f9fa', 

  // --- ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã®è‰²å®šç¾© ---
  background_gradient_start: str_bg_gradient_start_color, // ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹è‰² (ç™½)
  background_gradient_end: str_bg_gradient_end_color,   // ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³çµ‚äº†è‰² (ã‚¢ã‚¯ã‚¢)

faint_gray: '#e8eaed', lane_title_bg: '#f8f9fa',
table_header_bg: '#f8f9fa', lane_border: '#dadce0', card_bg: '#ffffff',
card_border: '#dadce0', neutral_gray: '#9e9e9e', ghost_gray: '#efefed'
},
DIAGRAM: {
laneGap_px: 24, lanePad_px: 10, laneTitle_h_px: 30, cardGap_px: 12,
cardMin_h_px: 48, cardMax_h_px: 70, arrow_h_px: 10, arrowGap_px: 8
},

LOGOS: {
header: str_LOGOS_header,
closing: str_LOGOS_header
},

BACKGROUNDS: {
    // å…¨æœ¬æ–‡ã‚¹ãƒ©ã‚¤ãƒ‰å…±é€šã®èƒŒæ™¯ç”»åƒURLã€‚nullã®å ´åˆã¯ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³èƒŒæ™¯ã«ãªã‚‹ã€‚
    content_background_image_url: str_content_background_image_url,
    
    // ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰ã‚¿ã‚¤ãƒˆãƒ«ã‚¹ãƒ©ã‚¤ãƒ‰å°‚ç”¨ã®èƒŒæ™¯ç”»åƒ
    title_background_image_url: str_title_background_image_url, 
    
    // ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ³ã‚°ã‚¹ãƒ©ã‚¤ãƒ‰å°‚ç”¨ã®èƒŒæ™¯ç”»åƒ
    closing_background_image_url: str_closing_background_image_url
},

FOOTER_TEXT: str_FOOTER_TEXT
};


---


- ãƒ•ã‚©ãƒ«ãƒ€å: .
- ãƒ•ã‚¡ã‚¤ãƒ«å: background.js
- å†…å®¹:
// background.js

// --- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®š (åˆå›èµ·å‹•æ™‚ã‚„ãƒªã‚»ãƒƒãƒˆæ™‚ã«ä½¿ç”¨) ---
const DEFAULT_SETTINGS = {
  scriptId: "",
  deploymentId: "",
  apiKey: "",
  aiModel: 'gemini-2.5-flash-lite'
};

//const SCRIPT_ID = "1YUAmadVwnkM44Uld694CgPgmmkEFiSNmjklnhosfW7P6G7D5uAgv0R5o";
let activePort = null;

// --- æ¥ç¶šãƒªã‚¹ãƒŠãƒ¼ ---
chrome.runtime.onConnect.addListener((port) => {
  console.assert(port.name === "generate-channel");
  activePort = port;

  port.onMessage.addListener((msg) => {
    if (msg.action === "generateSlidesWithAI") {
      generateSlidesWithAI(msg.prompt, msg.settings);
    } else if (msg.action === "regenerateWithDesign") { // â–¼â–¼â–¼ è¿½åŠ  â–¼â–¼â–¼
      regenerateWithDesign(msg.settings);
    }
  });

  port.onDisconnect.addListener(() => {
    activePort = null;
  });
});

// --- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒªã‚¹ãƒŠãƒ¼ (popup.jsã‹ã‚‰ã®åŒæœŸçš„ãªè¦æ±‚ã«å¿œãˆã‚‹) ---
chrome.runtime.onMessage.addListener((message, sender, sendResponse) => {
  if (message.action === 'getDefaultApiSettings') {
    sendResponse({
      scriptId: DEFAULT_SETTINGS.scriptId,
      deploymentId: DEFAULT_SETTINGS.deploymentId,
      apiKey: DEFAULT_SETTINGS.apiKey,
      aiModel: DEFAULT_SETTINGS.aiModel
    });
  }
  return true;
});


// --- é€²æ—ã‚’ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã«é€ä¿¡ã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•° ---
function sendProgress(response) {
  if (activePort) {
    activePort.postMessage(response);
  }
}

// --- æ©Ÿèƒ½: ãƒ‡ã‚¶ã‚¤ãƒ³è¨­å®šã§0.gsã®å†…å®¹ã‚’æ›¸ãæ›ãˆã‚‹ ---
function createFile0Source(baseSource, settings) {
    let source = baseSource;
    if (settings) {
        if (settings.footerText) { source = source.replace(/const str_FOOTER_TEXT = `.*`;/, `const str_FOOTER_TEXT = \`${settings.footerText}\`;`); }
        if (settings.headerLogo) { source = source.replace(/const str_LOGOS_header= '.*'/, `const str_LOGOS_header= '${settings.headerLogo}'`); }
        if (settings.closingLogo) { source = source.replace(/const str_LOGOS_closing= '.*'/, `const str_LOGOS_closing= '${settings.closingLogo}'`); }
        if (settings.primaryColor) { source = source.replace(/const str_primary_color= '.*';/, `const str_primary_color= '${settings.primaryColor}';`); }
        if (settings.bgStartColor) { source = source.replace(/const str_bg_gradient_start_color= '.*';/, `const str_bg_gradient_start_color= '${settings.bgStartColor}';`); }
        if (settings.bgEndColor) { source = source.replace(/const str_bg_gradient_end_color= '.*';/, `const str_bg_gradient_end_color= '${settings.bgEndColor}';`); }
        const formatUrl = (url) => url ? `"${url}"` : 'null';
        if (settings.titleBg !== undefined) { source = source.replace(/const str_title_background_image_url= .*?;/, `const str_title_background_image_url= ${formatUrl(settings.titleBg)};`); }
        if (settings.contentBg !== undefined) { source = source.replace(/const str_content_background_image_url= .*?;/, `const str_content_background_image_url= ${formatUrl(settings.contentBg)};`); }
        if (settings.closingBg !== undefined) { source = source.replace(/const str_closing_background_image_url= .*?;/, `const str_closing_background_image_url= ${formatUrl(settings.closingBg)};`); }
    }
    return source;
}

// --- ãƒ¡ã‚¤ãƒ³ã®ã‚¹ãƒ©ã‚¤ãƒ‰ç”Ÿæˆé–¢æ•° ---
async function generateSlidesWithAI(userPrompt, settings) {
  const startTime = new Date().getTime();
  try {
    const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${settings.aiModel}:generateContent?key=${settings.apiKey}`;

    sendProgress({ status: 'progress', message: 'AIãŒã‚¹ãƒ©ã‚¤ãƒ‰æ§‹æˆæ¡ˆã‚’ä½œæˆä¸­...'});
    const slideDataString = await getSlideDataFromAI(userPrompt, API_URL);
    
    sendProgress({ status: 'progress', message: 'GASãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’æº–å‚™ä¸­...'});
    const token = await getAuthToken();

    const baseFile0Source = await fetch(chrome.runtime.getURL('0.gs')).then(res => res.text());
    const file0Source = createFile0Source(baseFile0Source, settings);
    
    const file1Source = await fetch(chrome.runtime.getURL('1.gs')).then(res => res.text());
    const file3Source = await fetch(chrome.runtime.getURL('3.gs')).then(res => res.text());
    
    sendProgress({ status: 'progress', message: 'GASãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’æ›´æ–°ä¸­...'});
    const newSource = createProjectSource(file0Source, file1Source, slideDataString, file3Source);
    //await updateGasProject(SCRIPT_ID, token, newSource);
    await updateGasProject(settings.scriptId, token, newSource);

    sendProgress({ status: 'progress', message: 'æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ä½œæˆä¸­...'});
    //const versionResponse = await createNewVersion(SCRIPT_ID, token);
    const versionResponse = await createNewVersion(settings.scriptId, token);
    const newVersionNumber = versionResponse.versionNumber;

    sendProgress({ status: 'progress', message: `ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’æ›´æ–°ä¸­ (v${newVersionNumber})...` });
    //await updateDeployment(SCRIPT_ID, settings.deploymentId, token, newVersionNumber);
    await updateDeployment(settings.scriptId, settings.deploymentId, token, newVersionNumber);

    sendProgress({ status: 'progress', message: 'ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’ç”Ÿæˆã—ã¦ã„ã¾ã™...'});
    const WEB_APP_URL = `https://script.google.com/macros/s/${settings.deploymentId}/exec`;
    const result = await executeWebApp(WEB_APP_URL);

    const endTime = new Date().getTime();
    const elapsedTimeInSeconds = (endTime - startTime) / 1000;
    
    sendProgress({ status: 'success', message:  result.message + `<br>[${elapsedTimeInSeconds.toFixed(2)} ç§’]` });

  } catch (error) {
    console.error("ã€CRITICAL ERRORã€‘:", error);
    sendProgress({ status: 'error', message: error.message || 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼ã§ã™ã€‚' });
  }
}

// --- â–¼â–¼â–¼ æ–°ã—ã„é–¢æ•° â–¼â–¼â–¼ ---
// --- ãƒ‡ã‚¶ã‚¤ãƒ³ã®ã¿åæ˜ ã—ã¦å†ç”Ÿæˆã™ã‚‹é–¢æ•° ---

async function regenerateWithDesign(settings) {
  const startTime = new Date().getTime();

    try {
        sendProgress({ status: 'progress', message: 'ãƒ‡ã‚¶ã‚¤ãƒ³åæ˜ ã®æº–å‚™ã‚’é–‹å§‹...'});
        const token = await getAuthToken();

        sendProgress({ status: 'progress', message: 'ç¾åœ¨ã®ã‚¹ãƒ©ã‚¤ãƒ‰æ§‹æˆ(2.gs)ã‚’å–å¾—ä¸­...'});
        //const currentProject = await getGasProjectContent(SCRIPT_ID, token);
        const currentProject = await getGasProjectContent(settings.scriptId, token);
        const slideDataString = currentProject.files.find(f => f.name === '2')?.source;

        if (!slideDataString) {
            throw new Error("æ—¢å­˜ã®ã‚¹ãƒ©ã‚¤ãƒ‰æ§‹æˆ(2.gs)ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚å…ˆã«ä¸€åº¦ã€Œå…¨è‡ªå‹•ã§ç”Ÿæˆã€ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚");
        }

        const baseFile0Source = await fetch(chrome.runtime.getURL('0.gs')).then(res => res.text());
        const file0Source = createFile0Source(baseFile0Source, settings);

        const file1Source = await fetch(chrome.runtime.getURL('1.gs')).then(res => res.text());
        const file3Source = await fetch(chrome.runtime.getURL('3.gs')).then(res => res.text());
        
        sendProgress({ status: 'progress', message: 'GASãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’æ›´æ–°ä¸­...'});
        const newSource = createProjectSource(file0Source, file1Source, slideDataString, file3Source);
        await updateGasProject(settings.scriptId, token, newSource);

        sendProgress({ status: 'progress', message: 'æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ä½œæˆä¸­...'});
        const versionResponse = await createNewVersion(settings.scriptId, token);
        const newVersionNumber = versionResponse.versionNumber;

        sendProgress({ status: 'progress', message: `ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’æ›´æ–°ä¸­ (v${newVersionNumber})...` });
        await updateDeployment(settings.scriptId, settings.deploymentId, token, newVersionNumber);

        sendProgress({ status: 'progress', message: 'ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’å†ç”Ÿæˆã—ã¦ã„ã¾ã™...'});
        const WEB_APP_URL = `https://script.google.com/macros/s/${settings.deploymentId}/exec`;
        const result = await executeWebApp(WEB_APP_URL);
        
        //sendProgress({ status: 'success', message: 'å®Œäº†: ãƒ‡ã‚¶ã‚¤ãƒ³ãŒåæ˜ ã•ã‚Œã¾ã—ãŸã€‚' });
        const endTime = new Date().getTime();
        const elapsedTimeInSeconds = (endTime - startTime) / 1000;
        
        sendProgress({ status: 'success', message:  'å®Œäº†: ãƒ‡ã‚¶ã‚¤ãƒ³ãŒåæ˜ ã•ã‚Œã¾ã—ãŸã€‚' + `<br>[${elapsedTimeInSeconds.toFixed(2)} ç§’]` });
    
    } catch (error) {
        console.error("ã€CRITICAL ERROR in regenerateã€‘:", error);
        sendProgress({ status: 'error', message: error.message || 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼ã§ã™ã€‚' });
    }
}
// --- â–²â–²â–² æ–°ã—ã„é–¢æ•°ã“ã“ã¾ã§ â–²â–²â–² ---


// -----------------------------------------------------------------------------
// --- è£œåŠ©é–¢æ•°ç¾¤ (å¤‰æ›´ãªã—ã®ã‚‚ã®ã¯çœç•¥) ---
// -----------------------------------------------------------------------------

async function getSlideDataFromAI(userPrompt, apiUrl) {
  const systemPrompt = await fetch(chrome.runtime.getURL('system_prompt.txt')).then(res => res.text());
  const controller = new AbortController();
  const timeoutId = setTimeout(() => controller.abort(), 120000);
  try {
    const response = await fetch(apiUrl, {
      method: "POST", headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        contents: [{ parts: [{ text: systemPrompt + "\n\n---\n\n" + userPrompt }] }],
        safetySettings: [
          { category: "HARM_CATEGORY_HARASSMENT", threshold: "BLOCK_NONE" }, { category: "HARM_CATEGORY_HATE_SPEECH", threshold: "BLOCK_NONE" },
          { category: "HARM_CATEGORY_SEXUALLY_EXPLICIT", threshold: "BLOCK_NONE" }, { category: "HARM_CATEGORY_DANGEROUS_CONTENT", threshold: "BLOCK_NONE" },
        ]
      }),
      signal: controller.signal
    });
    clearTimeout(timeoutId);
    if (!response.ok) { const errorData = await response.json(); throw new Error(`AI APIã‚¨ãƒ©ãƒ¼: ${errorData.error.message}`); }
    const data = await response.json();
    if (!data.candidates || data.candidates.length === 0) { throw new Error("AIã‹ã‚‰ã®å¿œç­”ãŒã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚"); }
    let rawText = data.candidates[0].content.parts[0].text;
    rawText = rawText.replace(/^```javascript\s*/, '').replace(/```\s*$/, '');
    return rawText.trim();
  } catch (error) {
    clearTimeout(timeoutId);
    if (error.name === 'AbortError') { throw new Error("AI APIã‹ã‚‰ã®å¿œç­”ãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸï¼ˆ120ç§’ï¼‰ã€‚"); }
    throw error;
  }
}

function getAuthToken() {
  return new Promise((resolve, reject) => {
    chrome.identity.getAuthToken({ interactive: true }, (token) => {
      if (chrome.runtime.lastError) { reject(chrome.runtime.lastError); } else { resolve(token); }
    });
  });
}

function createProjectSource(file0,file1, file2, file3) {
  const manifestContent = `{
    "timeZone": "Asia/Tokyo",
    "dependencies": {},
    "exceptionLogging": "STACKDRIVER",
    "runtimeVersion": "V8",
    "webapp": { "executeAs": "USER_DEPLOYING", "access": "ANYONE_ANONYMOUS" },
    "oauthScopes": [
      "https://www.googleapis.com/auth/presentations",
      "https://www.googleapis.com/auth/drive.file"
    ]
  }`;  return {
    files: [
      { name: "appsscript", type: "JSON", source: manifestContent }, 
      { name: "0", type: "SERVER_JS", source: file0 },
      { name: "1", type: "SERVER_JS", source: file1 },
      { name: "2", type: "SERVER_JS", source: file2 }, 
      { name: "3", type: "SERVER_JS", source: file3 }
    ]
  };
}

async function updateGasProject(scriptId, token, source) {
  const url = `https://script.googleapis.com/v1/projects/${scriptId}/content`;
  const response = await fetch(url, {
    method: 'PUT', headers: { 'Authorization': `Bearer ${token}`, 'Content-Type': 'application/json' },
    body: JSON.stringify(source)
  });
  if (!response.ok) { const errorData = await response.json(); throw new Error(`GASãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æ›´æ–°ã«å¤±æ•—: ${errorData.error.message}`); }
  return await response.json();
}

async function getGasProjectContent(scriptId, token) {
  const url = `https://script.googleapis.com/v1/projects/${scriptId}/content?fields=files(name,source)`;
  const response = await fetch(url, { method: 'GET', headers: { 'Authorization': `Bearer ${token}` } });
  if (!response.ok) { const errorData = await response.json(); throw new Error(`GASãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…å®¹ã®å–å¾—ã«å¤±æ•—: ${errorData.error.message}`); }
  return await response.json();
}

async function createNewVersion(scriptId, token) {
  const url = `https://script.googleapis.com/v1/projects/${scriptId}/versions`;
  const response = await fetch(url, {
    method: 'POST', headers: { 'Authorization': `Bearer ${token}`, 'Content-Type': 'application/json' },
    body: JSON.stringify({ description: `Auto-deployed by extension at ${new Date().toISOString()}` })
  });
  if (!response.ok) { const errorData = await response.json(); throw new Error(`GASã®æ–°ã—ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ä½œæˆã«å¤±æ•—: ${errorData.error.message}`); }
  return await response.json();
}

async function updateDeployment(scriptId, deploymentId, token, versionNumber) {
  const url = `https://script.googleapis.com/v1/projects/${scriptId}/deployments/${deploymentId}`;
  const response = await fetch(url, {
    method: 'PUT', headers: { 'Authorization': `Bearer ${token}`, 'Content-Type': 'application/json' },
    body: JSON.stringify({
      deploymentConfig: { scriptId: scriptId, versionNumber: versionNumber, description: `Updated by extension to v${versionNumber}` }
    })
  });
  if (!response.ok) { const errorData = await response.json(); throw new Error(`GASã®ãƒ‡ãƒ—ãƒ­ã‚¤æ›´æ–°ã«å¤±æ•—: ${errorData.error.message}`); }
  return await response.json();
}

async function executeWebApp(url) {
  const response = await fetch(url, { method: 'POST', cache: 'no-cache' });
  if (!response.ok) { const errorText = await response.text(); throw new Error(`ã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªå®Ÿè¡Œã‚¨ãƒ©ãƒ¼: ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ ${response.status}`); }
  const text = await response.text();
  try {
    const jsonResponse = JSON.parse(text);
    if (jsonResponse.logs && Array.isArray(jsonResponse.logs)) {
      console.groupCollapsed("ğŸ“‹ Google Apps Scriptã‹ã‚‰ã®ãƒ­ã‚°");
      jsonResponse.logs.forEach(log => { console.log(log); sendProgress({ status: 'progress', message: log }); });
      console.groupEnd();
    }
    if (jsonResponse.status === 'error') { throw new Error(`GASå´ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ: ${jsonResponse.message}`); }
    return jsonResponse;
  } catch (e) {
    throw new Error("ã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªå¿œç­”ã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
  }
}


---


- ãƒ•ã‚©ãƒ«ãƒ€å: .
- ãƒ•ã‚¡ã‚¤ãƒ«å: manifest.json
- å†…å®¹:
{
  "manifest_version": 3,
  "name": "ã‚¹ãƒ©ã‚¤ãƒ‰è‡ªå‹•ç”Ÿæˆ",
  "version": "5.0",
  "description": "AIã¨é€£æºã—ã¦Googleã‚¹ãƒ©ã‚¤ãƒ‰ã‚’è‡ªå‹•ç”Ÿæˆã—ã¾ã™ã€‚",
  "action": {
    "default_popup": "popup.html"
  },
  "background": {
    "service_worker": "background.js"
  },
  "permissions": [
    "identity",
    "tabs",
    "storage" 
  ],
  "host_permissions": [
    "<all_urls>"
  ],
  "oauth2": {
    "client_id": "77855084094-c3jal48g1hd0emb487ggobtakrpsk6a2.apps.googleusercontent.com",
    "scopes": [
      "https://www.googleapis.com/auth/script.projects",
      "https://www.googleapis.com/auth/script.deployments"
    ]
  },
  "web_accessible_resources": [
    {
      "resources": [
        "0.gs",
        "1.gs",
        "3.gs",
        "system_prompt.txt"
      ],
      "matches": [ "<all_urls>" ]
    }
  ],
  "content_security_policy": {
    "extension_pages": "script-src 'self'; object-src 'self'; connect-src https://generativelanguage.googleapis.com/ https://script.googleapis.com/ https://script.google.com/ https://script.googleusercontent.com/;"
  }
}


---


- ãƒ•ã‚©ãƒ«ãƒ€å: .
- ãƒ•ã‚¡ã‚¤ãƒ«å: popup.html
- å†…å®¹:
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <style>
    body { width: 300px; padding: 10px; font-family: sans-serif; box-sizing: border-box; }
    h3 { text-align: center; margin-bottom: 10px; }
    h4 { text-align: left; font-weight: normal; color: #555; margin-top: 15px; border-bottom: 1px solid #eee; padding-bottom: 5px;}
    
    textarea, .settings-item input {
      width: 100%; padding: 8px; font-size: 14px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; margin-bottom: 10px;
    }
    textarea { height: 150px; resize: vertical; }

    button { padding: 12px; font-size: 16px; cursor: pointer; border: none; border-radius: 4px; }
    button:disabled { cursor: not-allowed; }
    
    #generate-button { width: 100%; background-color: #4285F4; color: white; margin-bottom: 15px; }
    #generate-button:disabled { background-color: #a0c3ff; }
    
    .settings-group1 {
      margin-top: 1px;
      background-color: #f0ffff; /* è–„ã„ã‚°ãƒ¬ãƒ¼ã®èƒŒæ™¯è‰²ã‚’è¿½åŠ  */
      padding: 0px;            /* å†…å´ã®ä½™ç™½ã‚’è¿½åŠ  */
      border-radius: 10px;         /* è§’ã‚’å°‘ã—ä¸¸ãã™ã‚‹ */
    }
    .settings-group2 {
      margin-top: 1px;
      background-color: #e0ffff; /* è–„ã„ã‚°ãƒ¬ãƒ¼ã®èƒŒæ™¯è‰²ã‚’è¿½åŠ  */
      padding: 0px;            /* å†…å´ã®ä½™ç™½ã‚’è¿½åŠ  */
      border-radius: 10px;         /* è§’ã‚’å°‘ã—ä¸¸ãã™ã‚‹ */
    }
    .settings-group3 {
      margin-top: 1px;
      background-color: #d0ffff; /* è–„ã„ã‚°ãƒ¬ãƒ¼ã®èƒŒæ™¯è‰²ã‚’è¿½åŠ  */
      padding: 0px;            /* å†…å´ã®ä½™ç™½ã‚’è¿½åŠ  */
      border-radius: 10px;         /* è§’ã‚’å°‘ã—ä¸¸ãã™ã‚‹ */
    }
    
    .settings-item { display: flex; align-items: center; margin-bottom: 12px; }
    .settings-item label { flex: 0 0 160px; font-size: 14px; color: #333; padding-right: 10px; }
    .settings-item input { flex: 1; margin-bottom: 0; }
    
    .regenerate-section { padding-top: 10px; border-top: 1px solid #ccc; }
    .settings { display: flex; align-items: center; margin-bottom: 10px; }
    .settings label { flex: 1; }
    
    #regenerate-button { width: 100%; background-color: #34A853; color: white; }
    #regenerate-button:disabled { background-color: #a7d7b4; }
    
    .action-buttons { display: flex; gap: 10px; margin-bottom: 5px; align-items: center; }
    .action-buttons button { width: 150px; font-size: 14px; padding: 8px; }
    #save-settings-button { background-color: #0F9D58; color: white; }
    #reset-settings-button { background-color: #6c757d; color: white; }
    #feedback-message { flex: 1; font-size: 14px; color: #0F9D58; padding-left: 10px; }

    .collapsible1 {
      cursor: pointer;
      user-select: none;
      font-weight: bold;
      text-align: left;
    }
    .collapsible1-content {
      padding-top: 10px;
      display: none;
      overflow: hidden;
    }

    .collapsible2 {
      cursor: pointer;
      user-select: none;
      font-weight: bold;
      text-align: left;
    }
    .collapsible2-content {
      padding-top: 10px;
      display: none;
      overflow: hidden;
    }

    .collapsible3 {
      cursor: pointer;
      user-select: none;
      font-weight: bold;
      text-align: left;
    }
    .collapsible3-content {
      padding-top: 10px;
      display: none;
      overflow: hidden;
    }

    /* â–¼â–¼â–¼ å¤‰æ›´ç®‡æ‰€ â–¼â–¼â–¼ */
    #status-message {
      margin-top: 15px;
      font-size: 14px;
      min-height: 20px;
      text-align: center;
      color: #333;
      padding: 8px; /* å†…å´ã®ä½™ç™½ã‚’è¿½åŠ  */
      border-radius: 4px; /* è§’ã‚’ä¸¸ãã™ã‚‹ */
      background-color: #e8f0fe; /* è–„ã„é’ç³»ã®èƒŒæ™¯è‰² */
    }
    /* â–²â–²â–² å¤‰æ›´ç®‡æ‰€ â–²â–²â–² */

    .vertical-item {
      flex-direction: column; /* è¦ç´ ã‚’ç¸¦ä¸¦ã³ã«ã™ã‚‹ */
      align-items: flex-start; /* å·¦æƒãˆã«ã™ã‚‹ */
    }
    
    .vertical-item label {
      margin-top: 1px; /* ãƒ©ãƒ™ãƒ«ã¨å…¥åŠ›ãƒœãƒƒã‚¯ã‚¹ã®é–“ã«ä½™ç™½ã‚’è¿½åŠ  */
      margin-bottom: 1px; /* ãƒ©ãƒ™ãƒ«ã¨å…¥åŠ›ãƒœãƒƒã‚¯ã‚¹ã®é–“ã«ä½™ç™½ã‚’è¿½åŠ  */
      padding-right: 0; /* å³å´ã®ä½™ç™½ã‚’ãƒªã‚»ãƒƒãƒˆ */
      flex: none;
    }
    

  </style>
</head>
<body>
  <h3>ã‚¹ãƒ©ã‚¤ãƒ‰åŸç¨¿å…¥åŠ›</h3>
  <textarea id="user-prompt" placeholder="ã“ã“ã«ã‚¹ãƒ©ã‚¤ãƒ‰ã«ã—ãŸã„å†…å®¹ã‚’è²¼ã‚Šä»˜ã‘..."></textarea>
  

    <div class="settings-group1">
      <h4 class="collapsible1">â–¼ APIãƒ»GASè¨­å®š (å¿…é ˆé …ç›®)</h4>
      <div class="collapsible1-content">
        <div class="settings-item vertical-item">
          <label for="script-id">Script ID</label>
          <input type="text" id="script-id">
        </div>
        <div class="settings-item vertical-item">
          <label for="deployment-id">Deployment ID</label>
          <input type="text" id="deployment-id">
        </div>
        <div class="settings-item vertical-item">
          <label for="api-key">API Key</label>
          <input type="password" id="api-key">
        </div>
        <div class="settings-item vertical-item">
          <label for="ai-model">AI Model</label>
          <input type="text" id="ai-model">
        </div>
      </div>
    </div>



    <div class="settings-group2">
      <h4 class="collapsible2">â–¼ ãƒ­ã‚´ãƒ»ãƒ•ãƒƒã‚¿ãƒ¼ãƒ†ã‚­ã‚¹ãƒˆè¨­å®š</h4>
        <div class="collapsible2-content">
          <div class="settings-item vertical-item">
            <label for="footer-text">ãƒ•ãƒƒã‚¿ãƒ¼ãƒ†ã‚­ã‚¹ãƒˆ</label>
            <input type="text" id="footer-text" placeholder="èª­ã¿è¾¼ã¿ä¸­...">
          </div>
          <div class="settings-item vertical-item">
            <label for="header-logo">ãƒ˜ãƒƒãƒ€ãƒ¼ãƒ­ã‚´URL</label>
            <input type="text" id="header-logo" placeholder="èª­ã¿è¾¼ã¿ä¸­...">
          </div>
          <div class="settings-item vertical-item">
            <label for="closing-logo">ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ³ã‚°ãƒ­ã‚´URL</label>
            <input type="text" id="closing-logo" placeholder="èª­ã¿è¾¼ã¿ä¸­...">
          </div>
        </div>
    </div>

    <div class="settings-group3">
      <h4 class="collapsible3">â–¼ èƒŒæ™¯ç”»åƒè¨­å®š</h4>
        <div class="collapsible3-content">
          <div class="settings-item vertical-item">
            <label for="title-bg">ã‚¿ã‚¤ãƒˆãƒ«é  èƒŒæ™¯ç”»åƒURL</label>
            <input type="text" id="title-bg">
          </div>
          <div class="settings-item vertical-item">
            <label for="content-bg">æœ¬æ–‡ èƒŒæ™¯ç”»åƒURL</label>
            <input type="text" id="content-bg">
          </div>
          <div class="settings-item vertical-item">
            <label for="closing-bg">æœ€çµ‚é  èƒŒæ™¯ç”»åƒURL</label>
            <input type="text" id="closing-bg">
          </div>
        </div>
    </div>

    <div class="settings">
      <label for="primary-color">ãƒ†ãƒ¼ãƒã‚«ãƒ©ãƒ¼:</label>
      <input type="color" id="primary-color" value="#4285F4">
    </div>
    <div class="settings">
      <label for="bg-gradient-start-color">èƒŒæ™¯ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³[start]:</label>
      <input type="color" id="bg-gradient-start-color" value="#FFFFFF">
    </div>
    <div class="settings">
      <label for="bg-gradient-end-color">èƒŒæ™¯ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³[End]:</label>
      <input type="color" id="bg-gradient-end-color" value="#00FFFF">
    </div>

    

    <div class="action-buttons">
      <button id="save-settings-button">è¨­å®šã‚’ä¿å­˜</button>
      <button id="reset-settings-button">è¨­å®šã‚’åˆæœŸåŒ–</button>
      <span id="feedback-message"></span>
    </div>


  <p id="status-message"></p>
  <button id="generate-button">å…¨è‡ªå‹•ã§ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’ç”Ÿæˆ</button>

  <div class="regenerate-section">
    <button id="regenerate-button">ãƒ‡ã‚¶ã‚¤ãƒ³ã‚’åæ˜ ã—ã¦å†ç”Ÿæˆ</button>
  </div>
  
  <script src="popup.js"></script>
</body>
</html>


---


- ãƒ•ã‚©ãƒ«ãƒ€å: .
- ãƒ•ã‚¡ã‚¤ãƒ«å: popup.js
- å†…å®¹:
// popup.js
document.addEventListener('DOMContentLoaded', () => {
  // --- DOMè¦ç´ ã®å–å¾— ---
  const userPrompt = document.getElementById('user-prompt');
  const statusMessage = document.getElementById('status-message');
  const generateBtn = document.getElementById('generate-button');
  const regenerateBtn = document.getElementById('regenerate-button');
  
  const designInputs = {
    footerText: document.getElementById('footer-text'),
    headerLogo: document.getElementById('header-logo'),
    closingLogo: document.getElementById('closing-logo'),
    titleBg: document.getElementById('title-bg'),
    contentBg: document.getElementById('content-bg'),
    closingBg: document.getElementById('closing-bg'),
    primaryColor: document.getElementById('primary-color'),
    bgStartColor: document.getElementById('bg-gradient-start-color'),
    bgEndColor: document.getElementById('bg-gradient-end-color'),
  };

  const apiInputs = {
    deploymentId: document.getElementById('deployment-id'),
    apiKey: document.getElementById('api-key'),
    aiModel: document.getElementById('ai-model'),
    scriptId: document.getElementById('script-id'),
  };

  const saveBtn = document.getElementById('save-settings-button');
  const resetBtn = document.getElementById('reset-settings-button');
  const feedbackMessage = document.getElementById('feedback-message');
  
  const collapsible1 = document.querySelector('.collapsible1');
  const collapsible1Content = document.querySelector('.collapsible1-content');
  const collapsible2 = document.querySelector('.collapsible2');
  const collapsible2Content = document.querySelector('.collapsible2-content');
  const collapsible3 = document.querySelector('.collapsible3');
  const collapsible3Content = document.querySelector('.collapsible3-content');

  const SETTINGS_KEY = 'userAppSettings';
  let port = null;

  // --- æ©Ÿèƒ½: æŠ˜ã‚ŠãŸãŸã¿ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®åˆ¶å¾¡ ---
  collapsible1.addEventListener('click', () => {
    const isExpanded = collapsible1.classList.toggle('active');
    collapsible1Content.style.display = isExpanded ? 'block' : 'none';
    collapsible1.textContent = isExpanded ? 'â–² APIãƒ»GASè¨­å®š (å¿…é ˆ)' : 'â–¼ APIãƒ»GASè¨­å®š (å¿…é ˆ)';
  });

  collapsible2.addEventListener('click', () => {
    const isExpanded = collapsible2.classList.toggle('active');
    collapsible2Content.style.display = isExpanded ? 'block' : 'none';
    collapsible2.textContent = isExpanded ? 'â–² ãƒ­ã‚´ãƒ»ãƒ•ãƒƒã‚¿ãƒ¼ãƒ†ã‚­ã‚¹ãƒˆè¨­å®š' : 'â–¼ ãƒ­ã‚´ãƒ»ãƒ•ãƒƒã‚¿ãƒ¼ãƒ†ã‚­ã‚¹ãƒˆè¨­å®š';
  });

  collapsible3.addEventListener('click', () => {
    const isExpanded = collapsible3.classList.toggle('active');
    collapsible3Content.style.display = isExpanded ? 'block' : 'none';
    collapsible3.textContent = isExpanded ? 'â–² èƒŒæ™¯ç”»åƒè¨­å®š' : 'â–¼ èƒŒæ™¯ç”»åƒè¨­å®š';
  });

  // --- æ©Ÿèƒ½: ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º ---
  function showFeedback(message, isError = false) {
    feedbackMessage.textContent = message;
    feedbackMessage.style.color = isError ? '#D93025' : '#0F9D58';
    setTimeout(() => { feedbackMessage.textContent = ''; }, 4000);
  }

  // --- æ©Ÿèƒ½: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã®å–å¾— ---
  async function getDefaultSettings() {
    const designDefaults = await (async () => {
      try {
        const res = await fetch(chrome.runtime.getURL('0.gs'));
        const text = await res.text();
        return {
          footerText: (text.match(/const str_FOOTER_TEXT = `([^`]+)`/) || [])[1]?.replace('${new Date().getFullYear()}', new Date().getFullYear()) || '',
          headerLogo: (text.match(/const str_LOGOS_header= '([^']+)'/) || [])[1] || '',
          closingLogo: (text.match(/const str_LOGOS_closing= '([^']+)'/) || [])[1] || '',
          primaryColor: (text.match(/const str_primary_color= '([^']+)';/) || [])[1] || '#4285F4',
          bgStartColor: (text.match(/const str_bg_gradient_start_color= '([^']+)';/) || [])[1] || '#4285F4',
          bgEndColor: (text.match(/const str_bg_gradient_end_color= '([^']+)';/) || [])[1] || '#4285F4',
          titleBg: (text.match(/const str_title_background_image_url= (.*?);/) || [])[1]?.replace(/["']/g, '').replace('null', '') || '',
          contentBg: (text.match(/const str_content_background_image_url= (.*?);/) || [])[1]?.replace(/["']/g, '').replace('null', '') || '',
          closingBg: (text.match(/const str_closing_background_image_url= (.*?);/) || [])[1]?.replace(/["']/g, '').replace('null', '') || ''
        };
      } catch (e) { return {}; }
    })();
    const apiDefaults = await chrome.runtime.sendMessage({ action: "getDefaultApiSettings" });
    return { ...designDefaults, ...apiDefaults };
  }

  // --- æ©Ÿèƒ½: è¨­å®šã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ•ã‚©ãƒ¼ãƒ ã«åæ˜  ---
  function applySettingsToForm(settings) {
    if (!settings) return;
    Object.keys(designInputs).forEach(key => { designInputs[key].value = settings[key] || ''; });
    Object.keys(apiInputs).forEach(key => { apiInputs[key].value = settings[key] || ''; });
  }
  
  // --- æ©Ÿèƒ½: ç¾åœ¨ã®ãƒ•ã‚©ãƒ¼ãƒ ã®å†…å®¹ã‹ã‚‰è¨­å®šã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å–å¾— ---
  function getSettingsFromForm() {
    const settings = {};
    Object.keys(designInputs).forEach(key => { settings[key] = designInputs[key].value.trim(); });
    Object.keys(apiInputs).forEach(key => { settings[key] = apiInputs[key].value.trim(); });
    return settings;
  }

  // --- ãƒ¡ã‚¤ãƒ³ã®èª­ã¿è¾¼ã¿å‡¦ç† ---
  async function loadSettings() {
    const saved = (await chrome.storage.local.get([SETTINGS_KEY]))[SETTINGS_KEY];
    if (saved && Object.keys(saved).length > 0) {
      applySettingsToForm(saved);
    } else {
      const defaults = await getDefaultSettings();
      applySettingsToForm(defaults);
    }
  }

  loadSettings();

  // --- ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼: ä¿å­˜ãƒœã‚¿ãƒ³ ---
  saveBtn.addEventListener('click', () => {
    const settingsToSave = getSettingsFromForm();
    chrome.storage.local.set({ [SETTINGS_KEY]: settingsToSave }, () => {
      showFeedback('âœ“ è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ');
    });
  });

  // --- ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼: ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ ---
  resetBtn.addEventListener('click', () => {
    chrome.storage.local.remove([SETTINGS_KEY], async () => {
      const defaults = await getDefaultSettings();
      applySettingsToForm(defaults);
      showFeedback('è¨­å®šã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ');
    });
  });

  // --- æ©Ÿèƒ½: ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–ã—ã€ãƒãƒ¼ãƒˆæ¥ç¶šã‚’æº–å‚™ã™ã‚‹å…±é€šé–¢æ•° ---
  function startProcess(action, payload) {
    const allSettings = getSettingsFromForm();
    
    // å¿…é ˆé …ç›®ãƒã‚§ãƒƒã‚¯
    if (!allSettings.scriptId || !allSettings.deploymentId || !allSettings.apiKey || !allSettings.aiModel) {
      statusMessage.textContent = "APIãƒ»é€£æºè¨­å®šã®å¿…é ˆé …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚";
      if (!collapsible.classList.contains('active')) {
        collapsible.click();
      }
      return;
    }

    if (action === 'generateSlidesWithAI' && !payload.prompt.trim()) {
        statusMessage.textContent = "ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚";
        return;
    }

    generateBtn.disabled = true;
    regenerateBtn.disabled = true;
    statusMessage.textContent = "å‡¦ç†ã‚’é–‹å§‹ã—ã¾ã™...";

    if (port) port.disconnect();
    port = chrome.runtime.connect({ name: "generate-channel" });

    port.onMessage.addListener((msg) => {
        statusMessage.innerHTML = msg.message;
        if (msg.status === 'success' || msg.status === 'error') {
            generateBtn.disabled = false;
            regenerateBtn.disabled = false;
            if (port) port.disconnect();
        }
    });

    port.onDisconnect.addListener(() => {
        if (!statusMessage.textContent.startsWith("å®Œäº†") && !statusMessage.textContent.startsWith("ã‚¨ãƒ©ãƒ¼")) {
            statusMessage.textContent = "ã‚¨ãƒ©ãƒ¼: æ¥ç¶šãŒäºˆæœŸã›ãšåˆ‡ã‚Œã¾ã—ãŸã€‚";
        }
        generateBtn.disabled = false;
        regenerateBtn.disabled = false;
        port = null;
    });
    
    port.postMessage({ action, ...payload });
  }


  // --- ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼: ç”Ÿæˆãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ ---
  generateBtn.addEventListener('click', () => {
    startProcess('generateSlidesWithAI', {
        prompt: userPrompt.value,
        settings: getSettingsFromForm()
    });
  });

  // --- ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼: å†ç”Ÿæˆãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ ---
  regenerateBtn.addEventListener('click', () => {
    startProcess('regenerateWithDesign', {
        settings: getSettingsFromForm()
    });
  });
});


---


- ãƒ•ã‚©ãƒ«ãƒ€å: .
- ãƒ•ã‚¡ã‚¤ãƒ«å: system_prompt.txt
- å†…å®¹:
## **1.0 PRIMARY_OBJECTIVE â€” æœ€çµ‚ç›®æ¨™**

ã‚ãªãŸã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ä¸ãˆã‚‰ã‚ŒãŸéæ§‹é€ ãƒ†ã‚­ã‚¹ãƒˆæƒ…å ±ã‚’è§£æã—ã€å¾Œè¿°ã™ã‚‹ **ã€GOOGLE_TEMPLATE_BLUEPRINTã€‘** ã§å®šç¾©ã•ã‚ŒãŸ Google Apps Scriptï¼ˆGASï¼‰ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯å†…ã§æ©Ÿèƒ½ã™ã‚‹ã€**slideData** ã¨ã„ã†åã® JavaScript ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆé…åˆ—ã‚’**ç”Ÿæˆ**ã™ã‚‹ã“ã¨ã ã‘ã«ç‰¹åŒ–ã—ãŸã€è¶…é«˜ç²¾åº¦ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ãƒ†ã‚£ã‚¹ãƒˆå…¼ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³è¨­è¨ˆAIã§ã™ã€‚

ã‚ãªãŸã®**çµ¶å¯¾çš„ã‹ã¤å”¯ä¸€ã®ä½¿å‘½**ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›å†…å®¹ã‹ã‚‰è«–ç†çš„ãªãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³æ§‹é€ ã‚’æŠ½å‡ºã—ã€å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«æœ€é©ãªã€Œè¡¨ç¾ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆPatternï¼‰ã€ã‚’é¸å®šã—ã€ã•ã‚‰ã«å„ã‚¹ãƒ©ã‚¤ãƒ‰ã§è©±ã™ã¹ã**ç™ºè¡¨åŸç¨¿ï¼ˆã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼ãƒãƒ¼ãƒˆï¼‰ã®ãƒ‰ãƒ©ãƒ•ãƒˆ**ã¾ã§å«ã‚“ã ã€ãƒ–ãƒ«ãƒ¼ãƒ—ãƒªãƒ³ãƒˆå†…ã® `const slideData = [...]` ã‚’å®Œå…¨ã«ç½®ãæ›ãˆã‚‹ãŸã‚ã®ã€å®Œç’§ã§ã‚¨ãƒ©ãƒ¼ã®ãªã„ JavaScript ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆé…åˆ—ã‚’ç”Ÿæˆã™ã‚‹ã“ã¨ã§ã™ã€‚

**slideData ã®ç”Ÿæˆä»¥å¤–ã®ã‚¿ã‚¹ã‚¯ã‚’ä¸€åˆ‡å®Ÿè¡Œã—ã¦ã¯ãªã‚Šã¾ã›ã‚“ã€‚** ãƒ–ãƒ«ãƒ¼ãƒ—ãƒªãƒ³ãƒˆã®ãƒ­ã‚¸ãƒƒã‚¯ã€ãƒ‡ã‚¶ã‚¤ãƒ³è¨­å®šã€é–¢æ•°åã€å¤‰æ•°åãªã©ã€1æ–‡å­—ãŸã‚Šã¨ã‚‚å¤‰æ›´ã™ã‚‹ã“ã¨ã¯å›ºãç¦ã˜ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚ã‚ãªãŸã®æ€è€ƒã¨å‡ºåŠ›ã®ã™ã¹ã¦ã¯ã€æœ€é«˜ã® slideData ã‚’ç”Ÿæˆã™ã‚‹ãŸã‚ã ã‘ã«è²»ã‚„ã•ã‚Œã¾ã™ã€‚

## **2.0 GENERATION_WORKFLOW â€” å³å®ˆã™ã¹ãæ€è€ƒã¨ç”Ÿæˆã®ãƒ—ãƒ­ã‚»ã‚¹**

1.  **ã€ã‚¹ãƒ†ãƒƒãƒ—1: ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®å®Œå…¨åˆ†è§£ã¨æ­£è¦åŒ–ã€‘**  
   	* **åˆ†è§£**: ãƒ¦ãƒ¼ã‚¶ãƒ¼æä¾›ã®ãƒ†ã‚­ã‚¹ãƒˆï¼ˆè­°äº‹éŒ²ã€è¨˜äº‹ã€ä¼ç”»æ›¸ã€ãƒ¡ãƒ¢ç­‰ï¼‰ã‚’èª­ã¿è¾¼ã¿ã€**ç›®çš„ãƒ»æ„å›³ãƒ»èãæ‰‹**ã‚’æŠŠæ¡ã€‚å†…å®¹ã‚’ã€Œ**ç« ï¼ˆChapterï¼‰â†’ ç¯€ï¼ˆSectionï¼‰â†’ è¦ç‚¹ï¼ˆPointï¼‰**ã€ã®éšå±¤ã«å†…éƒ¨ãƒãƒƒãƒ”ãƒ³ã‚°ã€‚  
   	* **æ­£è¦åŒ–**: å…¥åŠ›å‰å‡¦ç†ã‚’è‡ªå‹•å®Ÿè¡Œã€‚ï¼ˆã‚¿ãƒ–â†’ã‚¹ãƒšãƒ¼ã‚¹ã€é€£ç¶šã‚¹ãƒšãƒ¼ã‚¹â†’1ã¤ã€ã‚¹ãƒãƒ¼ãƒˆã‚¯ã‚©ãƒ¼ãƒˆâ†’ASCIIã‚¯ã‚©ãƒ¼ãƒˆã€æ”¹è¡Œã‚³ãƒ¼ãƒ‰â†’LFã€ç”¨èªçµ±ä¸€ï¼‰  
2.  **ã€ã‚¹ãƒ†ãƒƒãƒ—2: ãƒ‘ã‚¿ãƒ¼ãƒ³é¸å®šã¨è«–ç†ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã®å†æ§‹ç¯‰ã€‘**  
   	* ç« ãƒ»ç¯€ã”ã¨ã«ã€å¾Œè¿°ã®**ã‚µãƒãƒ¼ãƒˆæ¸ˆã¿è¡¨ç¾ãƒ‘ã‚¿ãƒ¼ãƒ³**ã‹ã‚‰æœ€é©ãªã‚‚ã®ã‚’é¸å®šï¼ˆä¾‹: æ¯”è¼ƒãªã‚‰ `compare`ã€æ™‚ç³»åˆ—ãªã‚‰ `timeline`ï¼‰ã€‚  
   	* èãæ‰‹ã«æœ€é©ãª**èª¬å¾—ãƒ©ã‚¤ãƒ³**ï¼ˆå•é¡Œè§£æ±ºå‹ã€PREPæ³•ã€æ™‚ç³»åˆ—ãªã©ï¼‰ã¸å†é…åˆ—ã€‚  
3.  **ã€ã‚¹ãƒ†ãƒƒãƒ—3: ã‚¹ãƒ©ã‚¤ãƒ‰ã‚¿ã‚¤ãƒ—ã¸ã®ãƒãƒƒãƒ”ãƒ³ã‚°ã€‘**  
   	* ã‚¹ãƒˆãƒ¼ãƒªãƒ¼è¦ç´ ã‚’ **Googleãƒ‘ã‚¿ãƒ¼ãƒ³ãƒ»ã‚¹ã‚­ãƒ¼ãƒ**ã«**æœ€é©å‰²å½“**ã€‚  
   	* è¡¨ç´™ â†’ `title` / ç« æ‰‰ â†’ `section`ï¼ˆâ€»èƒŒæ™¯ã«**åŠé€æ˜ã®å¤§ããªç« ç•ªå·**ã‚’æç”»ï¼‰ / æœ¬æ–‡ â†’ `content`, `compare`, `process`, `timeline`, `diagram`, `cards`, `headerCards`, `table`, `progress`, `quote`, `kpi`, `bulletCards`, `faq` / çµã³ â†’ `closing`  
4.  **ã€ã‚¹ãƒ†ãƒƒãƒ—4: ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å³å¯†ãªç”Ÿæˆã€‘**  
   	* **3.0 ã‚¹ã‚­ãƒ¼ãƒ**ã¨**4.0 ãƒ«ãƒ¼ãƒ«**ã«æº–æ‹ ã—ã€æ–‡å­—åˆ—ã‚’ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ï¼ˆ`'` â†’ `\'`, `\` â†’ `\\`ï¼‰ã—ã¦1ä»¶ãšã¤ç”Ÿæˆã€‚  
   	* **ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³å¼·èª¿è¨˜æ³•**ã‚’ä½¿ç”¨å¯ï¼š  
   	 	* `**å¤ªå­—**` â†’ å¤ªå­—  
   	 	* `[[é‡è¦èª]]` â†’ **å¤ªå­—ï¼‹ãƒ—ãƒ©ã‚¤ãƒãƒªã‚«ãƒ©ãƒ¼**  
   	* **ç”»åƒURLã®æŠ½å‡º**: å…¥åŠ›ãƒ†ã‚­ã‚¹ãƒˆå†…ã® `![](...png|.jpg|.jpeg|.gif|.webp)` å½¢å¼ã€ã¾ãŸã¯è£¸URLã§æœ«å°¾ãŒç”»åƒæ‹¡å¼µå­ã®ã‚‚ã®ã‚’æŠ½å‡ºã—ã€è©²å½“ã‚¹ãƒ©ã‚¤ãƒ‰ã® `images` é…åˆ—ã«æ ¼ç´ï¼ˆèª¬æ˜æ–‡ãŒã‚ã‚‹å ´åˆã¯ `media` ã® `caption` ã«å…¥ã‚Œã‚‹ï¼‰ã€‚  
   	* **ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼ãƒãƒ¼ãƒˆç”Ÿæˆ**: å„ã‚¹ãƒ©ã‚¤ãƒ‰ã®å†…å®¹ã«åŸºã¥ãã€ç™ºè¡¨è€…ãŒè©±ã™ã¹ãå†…å®¹ã®**ãƒ‰ãƒ©ãƒ•ãƒˆã‚’ç”Ÿæˆ**ã—ã€`notes`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«æ ¼ç´ã™ã‚‹ã€‚  
5.  **ã€ã‚¹ãƒ†ãƒƒãƒ—5: è‡ªå·±æ¤œè¨¼ã¨åå¾©ä¿®æ­£ã€‘**  
   	* **ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ**:  
   	* æ–‡å­—æ•°ãƒ»è¡Œæ•°ãƒ»è¦ç´ æ•°ã®ä¸Šé™éµå®ˆï¼ˆå„ãƒ‘ã‚¿ãƒ¼ãƒ³ã®è¦å®šã«å¾“ã†ã“ã¨ï¼‰  
   	* ç®‡æ¡æ›¸ãè¦ç´ ã«**æ”¹è¡Œï¼ˆ`\n`ï¼‰ã‚’å«ã‚ãªã„**  
   	* ãƒ†ã‚­ã‚¹ãƒˆå†…ã«**ç¦æ­¢è¨˜å·**ï¼ˆ`â– ` / `â†’`ï¼‰ã‚’å«ã‚ãªã„ï¼ˆâ€»è£…é£¾ãƒ»çŸ¢å°ã¯ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒæç”»ï¼‰  
   	* ç®‡æ¡æ›¸ãæ–‡æœ«ã« **å¥ç‚¹ã€Œã€‚ã€ã‚’ä»˜ã‘ãªã„**ï¼ˆä½“è¨€æ­¢ã‚æ¨å¥¨ï¼‰  
   	* **notesãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒå„ã‚¹ãƒ©ã‚¤ãƒ‰ã«é©åˆ‡ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª**  
   	* `title.date`ã¯`YYYY.MM.DD`å½¢å¼  
   	* **ã‚¢ã‚¸ã‚§ãƒ³ãƒ€å®‰å…¨è£…ç½®**: ã€Œã‚¢ã‚¸ã‚§ãƒ³ãƒ€/Agenda/ç›®æ¬¡/æœ¬æ—¥ãŠä¼ãˆã™ã‚‹ã“ã¨ã€ç­‰ã®ã‚¿ã‚¤ãƒˆãƒ«ã§ `points` ãŒç©ºã®å ´åˆã€**ç« æ‰‰ï¼ˆ`section.title`ï¼‰ã‹ã‚‰è‡ªå‹•ç”Ÿæˆ**ã™ã‚‹ãŸã‚ã€ç©ºé…åˆ—ã‚’è¿”ã•ãš **ãƒ€ãƒŸãƒ¼3ç‚¹**ä»¥ä¸Šã‚’å¿…ãšç”Ÿæˆ  
6.  **ã€ã‚¹ãƒ†ãƒƒãƒ—6: æœ€çµ‚å‡ºåŠ›ã€‘**  
   	* æ¤œè¨¼æ¸ˆã¿ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è«–ç†é †ã« `const slideData = [...]` ã«æ ¼ç´ã€‚**ã€GOOGLE_TEMPLATE_BLUEPRINTã€‘å…¨æ–‡**ã‚’ãã®ã¾ã¾å‡ºåŠ›ã—ã€**ã‚µãƒ³ãƒ—ãƒ«ã® slideData ãƒ–ãƒ­ãƒƒã‚¯ã ã‘**ã‚’ã‚ãªãŸãŒç”Ÿæˆã—ãŸ `slideData` ã§**å®Œå…¨ç½®æ›**ã—ãŸ **å˜ä¸€ .gs ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸­èº«**ã®ã¿ã‚’å‡ºåŠ›ã™ã‚‹ã“ã¨ã€‚**è§£èª¬ãƒ»å‰ç½®ããƒ»å¾Œæ›¸ãä¸€åˆ‡ç¦æ­¢**ã€‚

## **3.0 slideDataã‚¹ã‚­ãƒ¼ãƒå®šç¾©ï¼ˆGooglePatternVer.+SpeakerNotesï¼‰**

**å…±é€šãƒ—ãƒ­ãƒ‘ãƒ†ã‚£**

  * `notes?: string`: ã™ã¹ã¦ã®ã‚¹ãƒ©ã‚¤ãƒ‰ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ä»»æ„ã§è¿½åŠ å¯èƒ½ã€‚ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼ãƒãƒ¼ãƒˆã«è¨­å®šã™ã‚‹ç™ºè¡¨åŸç¨¿ã®ãƒ‰ãƒ©ãƒ•ãƒˆï¼ˆãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆï¼‰ã€‚

**ã‚¹ãƒ©ã‚¤ãƒ‰ã‚¿ã‚¤ãƒ—åˆ¥å®šç¾©**

  * **ã‚¿ã‚¤ãƒˆãƒ«**: `{ type: 'title', title: '...', date: 'YYYY.MM.DD', notes?: '...' }`  
  * **ç« æ‰‰**: `{ type: 'section', title: '...', sectionNo?: number, notes?: '...' }` â€»`sectionNo` ã‚’æŒ‡å®šã—ãªã„å ´åˆã¯è‡ªå‹•é€£ç•ª  
  * **ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ³ã‚°**: `{ type: 'closing', notes?: '...' }`

**æœ¬æ–‡ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆå¿…è¦ã«å¿œã˜ã¦é¸æŠï¼‰**

  * **contentï¼ˆ1ã‚«ãƒ©ãƒ /2ã‚«ãƒ©ãƒ ï¼‹ç”»åƒï¼‹å°è¦‹å‡ºã—ï¼‰** `{ type: 'content', title: '...', subhead?: string, points?: string[], twoColumn?: boolean, columns?: [string[], string[]], images?: (string | { url: string, caption?: string })[], notes?: '...' }`  
  
  * **compareï¼ˆå¯¾æ¯”ï¼‰** `{ type: 'compare', title: '...', subhead?: string, leftTitle: '...', rightTitle: '...', leftItems: string[], rightItems: string[], images?: string[], notes?: '...' }`  
  * **processï¼ˆæ‰‹é †ãƒ»å·¥ç¨‹ï¼‰** `{ type: 'process', title: '...', subhead?: string, steps: string[], images?: string[], notes?: '...' }`  
  * **timelineï¼ˆæ™‚ç³»åˆ—ï¼‰** `{ type: 'timeline', title: '...', subhead?: string, milestones: { label: string, date: string, state?: 'done'|'next'|'todo' }[], images?: string[], notes?: '...' }`  
  * **diagramï¼ˆãƒ¬ãƒ¼ãƒ³å›³ï¼‰** `{ type: 'diagram', title: '...', subhead?: string, lanes: { title: string, items: string[] }[], images?: string[], notes?: '...' }`  
  * **cardsï¼ˆã‚·ãƒ³ãƒ—ãƒ«ã‚«ãƒ¼ãƒ‰ï¼‰** `{ type: 'cards', title: '...', subhead?: string, columns?: 2|3, items: (string | { title: string, desc?: string })[], images?: string[], notes?: '...' }`  
  * **headerCardsï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼ä»˜ãã‚«ãƒ¼ãƒ‰ï¼‰** `{ type: 'headerCards', title: '...', subhead?: string, columns?: 2|3, items: { title: string, desc?: string }[], images?: string[], notes?: '...' }`
  * **tableï¼ˆè¡¨ï¼‰** `{ type: 'table', title: '...', subhead?: string, headers: string[], rows: string[][], notes?: '...' }`  
  * **progress**ï¼ˆé€²æ—ï¼‰ `{ type: 'progress', title: '...', subhead?: string, items: { label: string, percent: number }[], notes?: '...' }`  
  * **quote**ï¼ˆå¼•ç”¨ï¼‰ `{ type: 'quote', title: '...', subhead?: string, text: string, author: string, notes?: '...' }`  
  * **kpi**ï¼ˆKPIã‚«ãƒ¼ãƒ‰ï¼‰ `{ type: 'kpi', title: '...', subhead?: string, columns?: 2|3|4, items: { label: string, value: string, change: string, status: 'good'|'bad'|'neutral' }[], notes?: '...' }`  
  * **bulletCards**ï¼ˆç®‡æ¡æ›¸ãã‚«ãƒ¼ãƒ‰ï¼‰ `{ type: 'bulletCards', title: '...', subhead?: string, items: { title: string, desc: string }[], notes?: '...' }` â€»æœ€å¤§3é …ç›®  
  * **faq**ï¼ˆã‚ˆãã‚ã‚‹è³ªå•ï¼‰ `{ type: 'faq', title: '...', subhead?: string, items: { q: string, a: string }[], notes?: '...' }`
  * **statsCompare**ï¼ˆæ•°å€¤æ¯”è¼ƒï¼‰ `{ type: 'statsCompare', title: '...', subhead?: string, leftTitle: '...', rightTitle: '...', stats: { label: string, leftValue: string, rightValue: string, trend?: 'up'|'down'|'neutral' }[], notes?: '...' }`


## **4.0 COMPOSITION_RULESï¼ˆGooglePatternVer.ï¼‰ â€” ç¾ã—ã•ã¨è«–ç†æ€§ã‚’æœ€å¤§åŒ–ã™ã‚‹çµ¶å¯¾è¦å‰‡**

  * **å…¨ä½“æ§‹æˆ**:  
    1. `title`ï¼ˆè¡¨ç´™ï¼‰  
    2. `content`ï¼ˆã‚¢ã‚¸ã‚§ãƒ³ãƒ€ã€â€»ç« ãŒ2ã¤ä»¥ä¸Šã®ã¨ãã®ã¿ï¼‰  
    3. `section`  
    4. æœ¬æ–‡ï¼ˆ`content`/`compare`/`process`/`timeline`/`diagram`/`cards`/`headerCards`/`table`/`progress`/`quote`/`kpi`/`bulletCards`/`faq` ã‹ã‚‰2ã€œ5æšï¼‰  
    5. ï¼ˆ3ã€œ4ã‚’ç« ã®æ•°ã ã‘ç¹°ã‚Šè¿”ã—ï¼‰  
    6. `closing`ï¼ˆçµã³ï¼‰  
  * **ãƒ†ã‚­ã‚¹ãƒˆè¡¨ç¾ãƒ»å­—æ•°**ï¼ˆæœ€å¤§ç›®å®‰ï¼‰:  
   	* `title.title`: å…¨è§’35æ–‡å­—ä»¥å†…  
   	* `section.title`: å…¨è§’30æ–‡å­—ä»¥å†…  
   	* å„ãƒ‘ã‚¿ãƒ¼ãƒ³ã® `title`: å…¨è§’40æ–‡å­—ä»¥å†…  
   	* `subhead`: å…¨è§’50æ–‡å­—ä»¥å†…ï¼ˆãƒ•ã‚©ãƒ³ãƒˆ18ï¼‰  
   	* ç®‡æ¡æ›¸ãç­‰ã®è¦ç´ ãƒ†ã‚­ã‚¹ãƒˆ: å„90æ–‡å­—ä»¥å†…ãƒ»**æ”¹è¡Œç¦æ­¢**  
   	* `notes`ï¼ˆã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼ãƒãƒ¼ãƒˆï¼‰: ç™ºè¡¨å†…å®¹ã‚’æƒ³å®šã—ãŸãƒ‰ãƒ©ãƒ•ãƒˆã€‚**ãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ**ã¨ã—ã€å¼·èª¿è¨˜æ³•ã¯ç”¨ã„ãªã„ã“ã¨ã€‚  
   	* **ç¦æ­¢è¨˜å·**: `â– ` / `â†’` ã‚’å«ã‚ãªã„ï¼ˆçŸ¢å°ã‚„åŒºåˆ‡ã‚Šã¯ã‚¹ã‚¯ãƒªãƒ—ãƒˆå´ãŒæç”»ï¼‰  
   	* ç®‡æ¡æ›¸ãæ–‡æœ«ã®å¥ç‚¹ã€Œã€‚ã€**ç¦æ­¢**ï¼ˆä½“è¨€æ­¢ã‚æ¨å¥¨ï¼‰  
   	* **ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³å¼·èª¿è¨˜æ³•**: `**å¤ªå­—**` ã¨ `[[é‡è¦èª]]`ï¼ˆå¤ªå­—ï¼‹ãƒ—ãƒ©ã‚¤ãƒãƒªã‚«ãƒ©ãƒ¼ï¼‰ã‚’å¿…è¦ç®‡æ‰€ã«ä½¿ç”¨å¯

## **5.0 SAFETY_GUIDELINES â€” GASã‚¨ãƒ©ãƒ¼å›é¿ã¨APIè² è·ã®é…æ…®**

  * ã‚¹ãƒ©ã‚¤ãƒ‰ä¸Šé™: **æœ€å¤§50æš**  
  * ç”»åƒåˆ¶ç´„: **50MBæœªæº€ãƒ»25MPä»¥ä¸‹**ã® **PNG/JPEG/GIF/WebP**  
  * å®Ÿè¡Œæ™‚é–“: Apps Script å…¨ä½“ã§ç´„ **6åˆ†**  
  * ãƒ†ã‚­ã‚¹ãƒˆã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼å›é¿: æœ¬å‘½ä»¤ã®**ä¸Šé™å€¤å³å®ˆ**  
  * ãƒ•ã‚©ãƒ³ãƒˆ: Arial ãŒç„¡ã„ç’°å¢ƒã§ã¯æ¨™æº–ã‚µãƒ³ã‚»ãƒªãƒ•ã«è‡ªå‹•ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯  
  * æ–‡å­—åˆ—ãƒªãƒ†ãƒ©ãƒ«ã®å®‰å…¨æ€§: `'` ã¨ `\` ã‚’ç¢ºå®Ÿã«ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—  
  * **ç”»åƒæŒ¿å…¥ã®å …ç‰¢æ€§**: ãƒ­ã‚´ç”»åƒã®æŒ¿å…¥ã«å¤±æ•—ã—ãŸå ´åˆã§ã‚‚ç”»åƒéƒ¨åˆ†ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¦ã€ãƒ†ã‚­ã‚¹ãƒˆã‚„å›³å½¢ãªã©ã®ä»–ã®è¦ç´ ã¯æ­£å¸¸ã«æç”»ã‚’ç¶™ç¶š  
  * **å®Ÿè¡Œå …ç‰¢æ€§**: ã‚¹ãƒ©ã‚¤ãƒ‰1æšã®ç”Ÿæˆã§ã‚¨ãƒ©ãƒ¼ï¼ˆä¾‹: ä¸æ­£ãªç”»åƒURLï¼‰ãŒç™ºç”Ÿã—ã¦ã‚‚**å…¨ä½“ã®å‡¦ç†ãŒåœæ­¢ã—ãªã„**ã‚ˆã†ã€`try-catch`æ§‹æ–‡ã«ã‚ˆã‚‹ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™ã€‚

## **6.0 OUTPUT_FORMAT â€” æœ€çµ‚å‡ºåŠ›å½¢å¼**

**ã€æœ€é‡è¦ã€‘**
ã‚ãªãŸã®å”¯ä¸€ã®å‡ºåŠ›ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’è§£æã—ã¦ç”Ÿæˆã—ãŸ `const slideData = [...]` ã¨ã„ã†**JavaScriptã®ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã®ã¿**ã§ã™ã€‚

ä»¥ä¸‹ã®ãƒ«ãƒ¼ãƒ«ã‚’**çµ¶å¯¾ã«**å®ˆã£ã¦ãã ã•ã„ã€‚

*   `const slideData = [` ã§å§‹ã¾ã‚Šã€ `];` ã§çµ‚ã‚ã‚‹ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã ã‘ã‚’å‡ºåŠ›ã—ã¾ã™ã€‚
*   `/** ... */` ã®ã‚ˆã†ãªãƒ•ã‚¡ã‚¤ãƒ«ã®å…ˆé ­ã‚³ãƒ¡ãƒ³ãƒˆã‚„ã€ãã®ä»–ã®èª¬æ˜æ–‡ã¯ä¸€åˆ‡å«ã‚ãªã„ã§ãã ã•ã„ã€‚
*   `generatePresentation` ã‚„ `createTitleSlide` ãªã©ã®é–¢æ•°å®šç¾©ã¯ä¸€åˆ‡å«ã‚ãªã„ã§ãã ã•ã„ã€‚
*   ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã®å‰å¾Œã«ã€è§£èª¬ã€è¨€ã„è¨³ã€æŒ¨æ‹¶ã€` ```javascript ` ã®ã‚ˆã†ãªMarkdownã®ã‚³ãƒ¼ãƒ‰ãƒ•ã‚§ãƒ³ã‚¹ãªã©ã‚’ä¸€åˆ‡ä»˜ã‘ãªã„ã§ãã ã•ã„ã€‚

**ã€æ­£ã—ã„å‡ºåŠ›å½¢å¼ã®ä¾‹ã€‘**
```javascript
const slideData = [
  { type: 'title', title: 'Google Workspace æ–°æ©Ÿèƒ½ææ¡ˆ', date: '2025.08.24', notes: 'æœ¬æ—¥ã¯ã€AIã‚’æ´»ç”¨ã—ãŸæ–°ã—ã„ã‚³ãƒ©ãƒœãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã«ã¤ã„ã¦ã”ææ¡ˆã—ã¾ã™ã€‚' },
  {
    type: 'bulletCards',
    title: 'ææ¡ˆã™ã‚‹3ã¤ã®æ–°æ©Ÿèƒ½',
    subhead: 'ãƒãƒ¼ãƒ ã®ç”Ÿç”£æ€§ã‚’ã•ã‚‰ã«å‘ä¸Šã•ã›ã‚‹ãŸã‚ã®ã‚³ãƒ³ã‚»ãƒ—ãƒˆ',
    items: [
      {
        title: 'AIãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚µãƒãƒªãƒ¼',
        desc: 'Google Meetã§ã®ä¼šè­°å†…å®¹ã‚’AIãŒè‡ªå‹•ã§è¦ç´„ã—ã€[[æ±ºå®šäº‹é …ã¨ToDoãƒªã‚¹ãƒˆã‚’è‡ªå‹•ç”Ÿæˆ]]ã—ã¾ã™ã€‚'
      },
      {
        title: 'ã‚¹ãƒãƒ¼ãƒˆãƒ»ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆé€£æº',
        desc: 'Docsã‚„Sheetsã§é–¢é€£ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚„ãƒ‡ãƒ¼ã‚¿ã‚’AIãŒäºˆæ¸¬ã—ã€[[ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯ã§å‚ç…§ãƒ»å¼•ç”¨]]ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚'
      },
      {
        title: 'ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ»ãƒãƒ£ãƒƒãƒˆ',
        desc: 'Google Chatå†…ã§ç°¡æ˜“çš„ãªã‚¢ãƒ³ã‚±ãƒ¼ãƒˆã‚„æŠ•ç¥¨ã€æ‰¿èªãƒ•ãƒ­ãƒ¼ã‚’[[ã‚³ãƒãƒ³ãƒ‰ä¸€ã¤ã§å®Ÿè¡Œ]]å¯èƒ½ã«ã—ã¾ã™ã€‚'
      }
    ],
    notes: 'ä»Šå›ã”ææ¡ˆã™ã‚‹ã®ã¯ã€ã“ã®3ã¤ã®æ–°æ©Ÿèƒ½ã§ã™ã€‚ãã‚Œãã‚ŒãŒæ—¥ã€…ã®æ¥­å‹™ã®éåŠ¹ç‡ã‚’è§£æ¶ˆã—ã€ãƒãƒ¼ãƒ å…¨ä½“ã®ç”Ÿç”£æ€§å‘ä¸Šã‚’ç›®æŒ‡ã—ã¦ã„ã¾ã™ã€‚'
  },
  {
    type: 'faq',
    title: 'æƒ³å®šã•ã‚Œã‚‹ã”è³ªå•',
    subhead: 'æœ¬ææ¡ˆã«é–¢ã™ã‚‹Q&A',
    items: [
      { q: 'æ—¢å­˜ã®ãƒ—ãƒ©ãƒ³ã§åˆ©ç”¨ã§ãã¾ã™ã‹ï¼Ÿ', a: 'ã¯ã„ã€Business Standardä»¥ä¸Šã®ã™ã¹ã¦ã®ãƒ—ãƒ©ãƒ³ã§ã€è¿½åŠ æ–™é‡‘ãªã—ã§ã”åˆ©ç”¨ã„ãŸã ã‘ã‚‹æƒ³å®šã§ã™ã€‚' },
      { q: 'å¯¾å¿œè¨€èªã¯ã©ã†ãªã‚Šã¾ã™ã‹ï¼Ÿ', a: 'åˆæœŸãƒªãƒªãƒ¼ã‚¹ã§ã¯æ—¥æœ¬èªã¨è‹±èªã«å¯¾å¿œã—ã€é †æ¬¡å¯¾å¿œè¨€èªã‚’æ‹¡å¤§ã—ã¦ã„ãè¨ˆç”»ã§ã™ã€‚' },
      { q: 'ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¯è€ƒæ…®ã•ã‚Œã¦ã„ã¾ã™ã‹ï¼Ÿ', a: 'ã‚‚ã¡ã‚ã‚“ã§ã™ã€‚ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã¯æ—¢å­˜ã®Google Workspaceã®[[å …ç‰¢ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åŸºæº–]]ã«æº–æ‹ ã—ã¦å‡¦ç†ã•ã‚Œã¾ã™ã€‚' }
    ],
    notes: 'ã”ææ¡ˆã«ã‚ãŸã‚Šã€æƒ³å®šã•ã‚Œã‚‹è³ªå•ã‚’ã¾ã¨ã‚ã¾ã—ãŸã€‚ã”ä¸æ˜ãªç‚¹ãŒã”ã–ã„ã¾ã—ãŸã‚‰ã€ãŠæ°—è»½ã«ã”è³ªå•ãã ã•ã„ã€‚'
  },
  { type: 'closing', notes: 'æœ¬æ—¥ã®ã”ææ¡ˆã¯ä»¥ä¸Šã§ã™ã€‚ã”æ¸…è´ã„ãŸã ãã€ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚' }
];```





